# O3DE Ros2 Gem Development Guide

# Publishing a pull request

Make sure to read this guide and adjust your code accordingly before publishing a pull request.

The repository performs 3 pull request checks:

- License header check
- Code formatting check
- Build check

## License Header check

Each file in the Code directory (and CMakeLists.txt located at root)

should contain the license header (in form of a comment) provided below (you can also find it in the *[.licenserc.yaml](https://github.com/RobotecAI/o3de-ros2-gem/blob/development/.licenserc.yaml)* file):

```
Copyright (c) Contributors to the Open 3D Engine Project.
For complete copyright and license terms please see the LICENSE at the root of this distribution.

SPDX-License-Identifier: Apache-2.0 OR MIT
```

## Code formatting check

All of the *C++* files located in the Code directory **should be formatted** using clang-format 

(version **13**) with the *[.clang-format](https://github.com/RobotecAI/o3de-ros2-gem/blob/development/.clang-format)* file located in the root of the repository.

ðŸ’¡ If youâ€™re using Clion checkout [this block](https://www.notion.so/O3DE-Ros2-Gem-Development-Guide-e2643f4bd16e407db72df996f5dd449e).

## Build check

New changes in the O3DE engine API may require the build workflow to be configured. This can be achieved by adjusting the ***O3DE_SHA*** environment variable in the [Build.yml](https://github.com/RobotecAI/o3de-ros2-gem/blob/development/.github/workflows/Build.yml) file (located in the *.github/workflows* directory) to a different o3de **long format** commit hash.

ðŸ’¡ ***Note:*** Remember to make sure you chose a **stable** commit (at least a compilable one)

## Additional requirements

Remember to sign all of your commits (*-s flag*).

# Gem Development - Clion

ðŸ’¡ ***Disclaimer:*** These are the solutions that **worked for me**. If you have any suggestions feel free to give feedback.

## Clion Project Setup

### Requirements

These steps assume that you:

- have met all of the o3de engine requirements
- have installed the o3de engine (source)
- have registered the engine
- have met all of the [o3de ros2 gem requirements](https://github.com/RobotecAI/o3de-ros2-gem#requirements)
- have installed the Clion IDE

### Creating and Configuring the Clion Project

```bash
cd <directory_of_choice>
git clone https://github.com/RobotecAI/o3de-ros2-gem.git
# <gem_path> = <directory_of_choice>/o3de-ros2-gem
cd <o3de_install_dir>
mkdir ~/o3de-projects
scripts/o3de.sh create-project --pp ~/o3de-projects/<project-name>
# <project_path> = ~/o3de-projects/<project-name>
scripts/o3de.sh register --gem-path <gem_path>
scripts/o3de.sh enable-gem -gn ROS2 -pp <project_path>
```
ðŸ’¡ ***Note:*** Some commands may generate cycle dependency errors but they can be ignored since this is a known o3de engine bug [this issue](https://github.com/o3de/o3de/issues/10515).


1. Open Clion and select the `<project_path>` folder.
2. In the Clion IDE interface select *File/Settings/Build, Execution, Deployment*.
    1. Create a new toolchain that matches the one provided below.
        
        ![Untitled](static/toolchain.png)
        
    2. Create a new CMake profile (*under CMake*) that matches the one provided below (*build type can for now be Debug; we will change that when we load the CMake project*).
        
        You can adjust the **-j** flag (*use the **nproc** bash command*).
        
        ![Untitled](static/cmake-profile.png)
        
        ```
        CMake options:
        -G "Ninja Multi-Config" -DLY_3RDPARTY_PATH=~/o3de-packages
        Build options:
        -j 12
        ```
        
3. Now in the IDE interface right click on the **CMakeLists.txt** file under the **<project_name>** directory and select **Load CMake Project** option.
4. You should now be able to select between release, debug and profile Build types and see the o3de and the gem folders in Project files. Let the Clion perform all of the background tasks and youâ€™re good to go!

### Building the Project

In the Select *Run/Debug Configuration* you should be able to see all the Configurations generated by CMake. You can now create compound configurations that allow you to build and run the project (for example Project (name of your project) with Editor and AssetProcessor).

![Untitled](static/build-config.png)

## Code Formatting

Make sure to enable ClangFormat in the Clion Interface under *File/Settings/Editor/Code Style.* Clion should detect the **.clang-format** file (*located in the root directory of the gem*) automatically.

To reformat the code simply select *Code/Reformat Code* (**Ctrl+Alt+L**).